// Generated by CoffeeScript 1.3.3
var XanderClient, getParameterByName, xander;

getParameterByName = function(name) {
  var regex, regexS, results;
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  regexS = "[\\?&]" + name + "=([^&#]*)";
  regex = new RegExp(regexS);
  results = regex.exec(window.location.search);
  if (results === null) {
    return "";
  }
  return decodeURIComponent(results[1].replace(/\+/g, " "));
};

XanderClient = (function() {
  var first_slot;

  function XanderClient() {}

  first_slot = 0;

  XanderClient.prototype.showVariantBar = function() {
    console.log("Show variant bar");
    $('body').prepend("<div id='__variants' style='width: 100%; background: black; color: white; border-bottom: 5px solid #CCC'>\n</div>");
    return $("*[data-variants]").each(function(i, x) {
      var options, variants;
      variants = $(x).find("> [data-variant]");
      options = "";
      variants.each(function(i, y) {
        return options += " <a onclick='xander.showVariant(\"" + ($(x).attr('data-variants')) + "\",\"" + ($(y).attr('data-variant')) + "\")'>" + ($(y).attr('data-variant')) + "</a>";
      });
      return $('#__variants').append("<div><span>" + ($(x).attr('data-variants')) + "</span><span>" + options + "</span></div>");
    });
  };

  XanderClient.prototype.showVariant = function(name, subname) {
    var variant, variants;
    variants = $("*[data-variants='" + name + "']");
    $(variants).find("> [data-variant]").hide();
    return variant = $(variants).find("> [data-variant='" + subname + "']").show();
  };

  XanderClient.prototype.chooseVariant = function() {
    var all_choices, slot_number;
    slot_number = first_slot;
    all_choices = $("*[data-variants]");
    all_choices.each(function(i, x) {
      var variants;
      slot_number += 1;
      variants = $(x).find("> [data-variant]");
      variants.hide();
      $(variants[parseInt(Math.random() * variants.length)]).show().attr('data-variant-chosen', slot_number);
      return slot_number += 1;
    });
    if (all_choices.length > 5) {
      return typeof console !== "undefined" && console !== null ? console.log("You have too many variants to track!  Google Analytics limits the number of custom variable slots to 5.") : void 0;
    }
  };

  XanderClient.prototype.callAnalytics = function() {
    return $("*[data-variants]").each(function(i, x) {
      var chosen, slot_number, title, variant;
      chosen = $(x).find('*[data-variant-chosen]')[0];
      slot_number = $(chosen).attr('data-variant-chosen');
      title = $(x).attr('data-variants' || ("slot_" + slot_number));
      variant = $(chosen).attr('data-variant');
      return _gaq.push(['_setCustomVar', slot_number, title, variant, 2]);
    });
  };

  return XanderClient;

})();

xander = new XanderClient();

$(function() {
  if (getParameterByName('showVariants') === 'true') {
    xander.showVariantBar();
  }
  xander.chooseVariant();
  return xander.callAnalytics();
});

window.xander = xander;
